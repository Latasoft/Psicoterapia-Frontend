<div class="modal-overlay" (click)="cerrarModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    
    <!-- Header -->
    <div class="modal-header">
      <button class="btn-cerrar" (click)="cerrarModal()">&times;</button>
      <div class="header-content">
        <h2>{{ paquete?.nombre }}</h2>
        <div class="paquete-info">
          <span class="info-badge duracion-badge">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            {{ paquete?.duracion }} minutos por sesi√≥n
          </span>
          <span class="info-badge sesiones-badge" *ngIf="paquete && paquete.sesiones && paquete.sesiones > 1">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
            </svg>
            {{ paquete.sesiones }} sesiones
          </span>
        </div>
      </div>
      <div class="progress-bar">
        <div class="progress-step" [class.active]="paso >= 1">1</div>
        <div class="progress-line" [class.active]="paso >= 2"></div>
        <div class="progress-step" [class.active]="paso >= 2">2</div>
        <div class="progress-line" [class.active]="paso >= 3"></div>
        <div class="progress-step" [class.active]="paso >= 3">3</div>
      </div>
    </div>

    <!-- Contenido -->
    <div class="modal-body">

      <!-- PASO 1: Calendario Semanal - Selecci√≥n m√∫ltiple mejorada -->
      <div class="paso-container" *ngIf="paso === 1">
        <h3>Selecciona tus {{ paquete?.sesiones }} sesiones</h3>

        <!-- Grid de sesiones para marcar/desmarcar -->
        <div class="sesiones-selector" *ngIf="paquete">
          <p class="sesiones-instruccion">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
            </svg>
            Haz clic en una sesi√≥n para elegir su fecha y hora. Luego selecciona el horario en el calendario.
          </p>
          
          <div class="sesiones-grid">
            <button
              *ngFor="let i of [1, 2, 3, 4].slice(0, paquete.sesiones)"
              class="sesion-slot"
              [class.vacio]="obtenerIconoEstadoSesion(i) === 'vacio'"
              [class.activo]="obtenerIconoEstadoSesion(i) === 'activo'"
              [class.completado]="obtenerIconoEstadoSesion(i) === 'completado'"
              (click)="activarSeleccionSesion(i)"
            >
              <div class="sesion-slot-header">
                <span class="sesion-slot-numero">Sesi√≥n {{ i }}</span>
                <div class="sesion-slot-icon">
                  <!-- √çcono vac√≠o -->
                  <svg *ngIf="obtenerIconoEstadoSesion(i) === 'vacio'" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <!-- √çcono activo (seleccionando) -->
                  <svg *ngIf="obtenerIconoEstadoSesion(i) === 'activo'" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.042 21.672L13.684 16.6m0 0l-2.51 2.225.569-9.47 5.227 7.917-3.286-.672zM12 2.25V4.5m5.834.166l-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243l-1.59-1.59" />
                  </svg>
                  <!-- √çcono completado -->
                  <svg *ngIf="obtenerIconoEstadoSesion(i) === 'completado'" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                </div>
              </div>
              
              <div class="sesion-slot-body">
                <!-- Si est√° vac√≠a -->
                <div *ngIf="!sesionEstaSeleccionada(i)" class="sesion-slot-empty">
                  <span>Click para elegir</span>
                </div>
                
                <!-- Si est√° seleccionada -->
                <div *ngIf="sesionEstaSeleccionada(i)" class="sesion-slot-data">
                  <div class="sesion-slot-fecha">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                    </svg>
                    {{ formatearFecha(obtenerSesion(i)!.fecha) }}
                  </div>
                  <div class="sesion-slot-hora">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    {{ obtenerSesion(i)!.horario.inicio }} - {{ obtenerSesion(i)!.horario.fin }}
                  </div>
                  <button 
                    class="sesion-slot-clear"
                    (click)="desmarcarSesion(i, $event)"
                    title="Desmarcar sesi√≥n"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>

              <!-- Indicador de activo -->
              <div *ngIf="modoSeleccionSesion === i" class="sesion-slot-pulse">
                Selecciona fecha y hora ‚Üì
              </div>
            </button>
          </div>

          <!-- Contador de progreso -->
          <div class="sesiones-contador-mini">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>{{ sesionesSeleccionadas.length }} de {{ paquete.sesiones }} sesiones seleccionadas</span>
          </div>
        </div>

        <!-- Informaci√≥n de duraci√≥n -->
        <div class="info-duracion" *ngIf="paquete && modoSeleccionSesion">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          <span>Seleccionando <strong>Sesi√≥n {{ modoSeleccionSesion }}</strong>. Cada sesi√≥n dura <strong>{{ paquete.duracion }} minutos</strong>.</span>
        </div>

        <!-- Nuevo calendario semanal -->
        <app-calendario-semanal
          [paqueteId]="paquete!.id!"
          (seleccion)="onSeleccionCalendario($event)"
        ></app-calendario-semanal>

        <div class="modal-actions">
          <button 
            class="btn-primary btn-large"
            [disabled]="!paquete || sesionesSeleccionadas.length !== paquete.sesiones"
            (click)="continuarAPaso2()"
          >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Continuar con todas las sesiones
          </button>
        </div>
      </div>

      <!-- PASO 2: Datos del paciente -->
      <div class="paso-container" *ngIf="paso === 2">
        <div class="paso-header">
          <div class="paso-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
            </svg>
          </div>
          <h3>Tus datos personales</h3>
          <p class="paso-descripcion">Completa tus datos para confirmar la reserva</p>
        </div>

        <form class="form-paciente">
          <div class="form-row">
            <div class="form-group">
              <label>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5zm6-10.125a1.875 1.875 0 11-3.75 0 1.875 1.875 0 013.75 0zm1.294 6.336a6.721 6.721 0 01-3.17.789 6.721 6.721 0 01-3.168-.789 3.376 3.376 0 016.338 0z" />
                </svg>
                RUT <span class="required">*</span>
              </label>
              <input 
                type="text" 
                [(ngModel)]="datosPaciente.rut"
                name="rut"
                placeholder="12.345.678-9"
                (blur)="formatearRUT()"
                required
              />
            </div>

            <div class="form-group">
              <label>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
                </svg>
                Nombre completo <span class="required">*</span>
              </label>
              <input 
                type="text" 
                [(ngModel)]="datosPaciente.nombre"
                name="nombre"
                placeholder="Juan P√©rez"
                required
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
                </svg>
                Email <span class="required">*</span>
              </label>
              <input 
                type="email" 
                [(ngModel)]="datosPaciente.email"
                name="email"
                placeholder="juan@ejemplo.com"
                required
              />
            </div>

            <div class="form-group">
              <label>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
                </svg>
                Tel√©fono <span class="required">*</span>
              </label>
              <input 
                type="tel" 
                [(ngModel)]="datosPaciente.telefono"
                name="telefono"
                placeholder="+56 9 1234 5678"
                required
              />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                </svg>
                Direcci√≥n (opcional)
              </label>
              <input 
                type="text" 
                [(ngModel)]="datosPaciente.direccion"
                name="direccion"
                placeholder="Calle 123, Depto 45"
              />
            </div>

            <div class="form-group">
              <label>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 6.75V15m6-6v8.25m.503 3.498l4.875-2.437c.381-.19.622-.58.622-1.006V4.82c0-.836-.88-1.38-1.628-1.006l-3.869 1.934c-.317.159-.69.159-1.006 0L9.503 3.252a1.125 1.125 0 00-1.006 0L3.622 5.689C3.24 5.88 3 6.27 3 6.695V19.18c0 .836.88 1.38 1.628 1.006l3.869-1.934c.317-.159.69-.159 1.006 0l4.994 2.497c.317.158.69.158 1.006 0z" />
                </svg>
                Comuna (opcional)
              </label>
              <input 
                type="text" 
                [(ngModel)]="datosPaciente.comuna"
                name="comuna"
                placeholder="Santiago"
              />
            </div>
          </div>

          <div class="form-group full-width">
            <label>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
              </svg>
              Notas adicionales (opcional)
            </label>
            <textarea 
              [(ngModel)]="datosPaciente.notas"
              name="notas"
              placeholder="¬øHay algo que debamos saber? Menciona aqu√≠ cualquier detalle relevante..."
              rows="3"
            ></textarea>
          </div>
        </form>

        <div class="modal-actions">
          <button class="btn-secondary" (click)="volverPaso()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            Volver
          </button>
          <button class="btn-primary" (click)="continuarAPaso3()">
            Continuar
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3" />
            </svg>
          </button>
        </div>
      </div>

      <!-- PASO 3: Pago -->
      <div class="paso-container" *ngIf="paso === 3">
        <div class="paso-header">
          <div class="paso-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.746 3.746 0 011.043 3.296A3.745 3.745 0 0121 12z" />
            </svg>
          </div>
          <h3>Confirmar y pagar</h3>
          <p class="paso-descripcion">Revisa tu reserva y selecciona el m√©todo de pago</p>
        </div>

        <!-- Resumen -->
        <div class="resumen-reserva">
          <div class="resumen-header">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
            </svg>
            <h4>Resumen de tu reserva</h4>
          </div>
          
          <div class="resumen-grid">
            <div class="resumen-item">
              <div class="resumen-label">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z" />
                </svg>
                <span>Tratamiento</span>
              </div>
              <strong>{{ paquete?.nombre }}</strong>
            </div>
            
            <div class="resumen-item">
              <div class="resumen-label">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 6v.75m0 3v.75m0 3v.75m0 3v.75m-9-12v.75m0 3v.75m0 3v.75m0 3v.75m-1.5-15h13.5A2.25 2.25 0 0121 6v12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18V6a2.25 2.25 0 012.25-2.25z" />
                </svg>
                <span>Total de sesiones</span>
              </div>
              <strong>{{ paquete?.sesiones }} sesiones de {{ paquete?.duracion }} min</strong>
            </div>

            <!-- Lista de sesiones seleccionadas -->
            <div class="resumen-sesiones-list">
              <h5>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
                </svg>
                Fechas y horarios:
              </h5>
              <div class="sesion-resumen" *ngFor="let sesion of sesionesSeleccionadas">
                <span class="sesion-num">Sesi√≥n {{ sesion.numero }}:</span>
                <span class="sesion-detalle">{{ formatearFecha(sesion.fecha) }} ‚Ä¢ {{ sesion.horario.inicio }}-{{ sesion.horario.fin }}</span>
              </div>
            </div>
            
            <div class="resumen-item resumen-total">
              <div class="resumen-label">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                </svg>
                <span>Total a pagar</span>
              </div>
              <strong class="total-amount">${{ paquete?.precio_nacional?.toLocaleString('es-CL') }}</strong>
            </div>
          </div>
        </div>

        <!-- M√©todos de pago -->
        <div class="metodos-pago">
          <div class="pago-header">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
            </svg>
            <h4>M√©todo de pago</h4>
          </div>
          
          <div class="pago-buttons">
            <button 
              class="btn-pago"
              [class.seleccionado]="metodoPago === 'webpay'"
              (click)="seleccionarMetodoPago('webpay')"
            >
              <div class="pago-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z" />
                </svg>
              </div>
              <div class="pago-info">
                <span class="pago-nombre">Webpay</span>
                <span class="pago-descripcion">Tarjetas de cr√©dito/d√©bito</span>
              </div>
              <div class="pago-check" *ngIf="metodoPago === 'webpay'">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
              </div>
            </button>
            
            <button 
              class="btn-pago"
              [class.seleccionado]="metodoPago === 'mercadopago'"
              (click)="seleccionarMetodoPago('mercadopago')"
            >
              <div class="pago-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                </svg>
              </div>
              <div class="pago-info">
                <span class="pago-nombre">MercadoPago</span>
                <span class="pago-descripcion">Pago r√°pido y seguro</span>
              </div>
              <div class="pago-check" *ngIf="metodoPago === 'mercadopago'">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
              </div>
            </button>
            
            <button 
              class="btn-pago"
              [class.seleccionado]="metodoPago === 'klap'"
              (click)="seleccionarMetodoPago('klap')"
            >
              <div class="pago-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3" />
                </svg>
              </div>
              <div class="pago-info">
                <span class="pago-nombre">KLAP</span>
                <span class="pago-descripcion">Pago con QR m√≥vil</span>
              </div>
              <div class="pago-check" *ngIf="metodoPago === 'klap'">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
              </div>
            </button>
            
            <!-- Bot√≥n de pago de prueba -->
            <button 
              class="btn-pago btn-pago-prueba"
              [class.seleccionado]="metodoPago === 'prueba'"
              (click)="seleccionarMetodoPago('prueba')"
              title="Solo para desarrollo - No procesa pago real"
            >
              <div class="pago-icon pago-icon-prueba">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232 1.232 3.233 0 4.465l-1.402 1.402m-14.8-7.269l-1.402 1.402c-1.232 1.232-1.232 3.233 0 4.465l1.402 1.402m0 0l4.655 4.655a3 3 0 004.243 0L19.35 21.35M4.867 19.125h.008v.008h-.008v-.008z" />
                </svg>
              </div>
              <div class="pago-info">
                <span class="pago-nombre">üß™ PAGO DE PRUEBA</span>
                <span class="pago-descripcion">Sin cargo - Solo desarrollo</span>
              </div>
              <div class="pago-check" *ngIf="metodoPago === 'prueba'">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                </svg>
              </div>
            </button>
          </div>
        </div>

        <div class="alert alert-error" *ngIf="errorMessage">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
          </svg>
          <span>{{ errorMessage }}</span>
        </div>

        <div class="modal-actions">
          <button class="btn-secondary" (click)="volverPaso()" [disabled]="procesando">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            Volver
          </button>
          <button 
            class="btn-primary btn-confirmar"
            [disabled]="!metodoPago || procesando"
            (click)="confirmarReserva()"
          >
            <svg *ngIf="!procesando" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 01-1.043 3.296 3.745 3.745 0 01-3.296 1.043A3.745 3.745 0 0112 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 01-3.296-1.043 3.745 3.745 0 01-1.043-3.296A3.745 3.745 0 013 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 011.043-3.296 3.746 3.746 0 013.296-1.043A3.746 3.746 0 0112 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 013.296 1.043 3.746 3.746 0 011.043 3.296A3.745 3.745 0 0121 12z" />
            </svg>
            <span *ngIf="!procesando">Confirmar y Pagar</span>
            <span *ngIf="procesando" class="procesando-text">
              <span class="spinner"></span>
              Procesando...
            </span>
          </button>
        </div>
      </div>

    </div>
  </div>
</div>
