<div class="outer-container">
  <!-- Panel de Administración -->
  <div *ngIf="isLoggedIn" class="admin-panel">
    <button (click)="toggleAdminMode()" class="admin-toggle-btn" [class.active]="adminMode">
      <i class="fas fa-cog"></i>
      {{ adminMode ? 'Salir del modo admin' : 'Modo administración' }}
    </button>
  </div>

  <!-- Imagen editable -->
  <div class="image-container" [class.admin-active]="adminMode">
    <img [src]="bannerImage || 'assets/default-banner.jpg'" alt="Imagen Terapia" class="form-image" />
    <div *ngIf="adminMode" class="edit-overlay">
      <button (click)="onImageClick('banner')" class="edit-btn">
        <i class="fas fa-edit"></i> Cambiar imagen
      </button>
    </div>
  </div>

  <!-- Sección Sobre mí editable -->
  <div class="about-me">
    <h2 class="about-title" [contentEditable]="adminMode">{{ aboutContent.title }}</h2>
    <p class="about-description" 
       [contentEditable]="adminMode" 
       (blur)="onContentChange()"
       (input)="onTextChange($event, 'description')">
      {{ aboutContent.description }}
    </p>
  </div>

  <!-- Cards editables -->
  <div class="cards-container">
    <div class="card" *ngFor="let card of cards; let i = index">
      <h3 class="card-title" >
        {{ card.title }}
      </h3>
      <p class="card-description" >
        {{ card.description }}
      </p>
    </div>
  </div>

 <!-- Formulario de Reserva -->
<!-- Formulario de Reserva -->
<div class="form-container">
  <h1 class="title">Agenda tu hora aquí</h1>

  <!-- Indicadores de pasos -->
  <div class="step-indicators">
    <div
      class="step"
      [class.active]="step === 1"
      [class.completed]="step > 1"
    >
      1
    </div>
    <div
      class="step"
      [class.active]="step === 2"
      [class.completed]="step > 2"
    >
      2
    </div>
    <div
      class="step"
      [class.active]="step === 3"
    >
      3
    </div>
  </div>

  <!-- Sección 1 -->
<div *ngIf="step === 1" class="form-step">
  <!-- Tratamiento -->
  <div class="form-group">
    <label for="tratamiento">Tratamiento</label>
    <select
      id="tratamiento"
      [(ngModel)]="tratamiento"
      name="tratamiento"
      required
      (change)="actualizarPrecio()"
    >
      <option value="" disabled selected>Selecciona un tratamiento</option>
      <option *ngFor="let t of tratamientosDisponibles" [value]="t.nombre">
        {{ t.nombre }}
      </option>
    </select>
  </div>

  <!-- Precios -->
  <p class="price" *ngIf="precio.nacional !== null">
    Valor del tratamiento nacional:
    <span class="amount">${{ precio.nacional | number: '1.0-0' }}</span>
  </p>

  <p class="price" *ngIf="precio.internacional !== null">
    Valor del tratamiento internacional:
    <span class="amount">${{ precio.internacional | number: '1.0-0' }} USD</span>
  </p>

  <p class="price" *ngIf="precio.sesiones !== null">
    Número de sesiones:
    <span class="amount">{{ precio.sesiones }}</span>
  </p>

  <!-- Nombre -->
  <div class="form-group">
    <label for="nombre">Nombre</label>
    <input
      id="nombre"
      type="text"
      [(ngModel)]="nombre"
      name="nombre"
      required
      placeholder="Ingresa tu nombre"
    />
  </div>

  <!-- Correo -->
  <div class="form-group">
    <label for="correo">Correo Electrónico</label>
    <input
      id="correo"
      type="email"
      [(ngModel)]="correo"
      name="correo"
      required
      placeholder="Ingresa tu correo"
    />
  </div>

  <!-- Botón siguiente -->
  <button
    (click)="goToStep(2)"
    class="submit-btn"
    [disabled]="!nombre || !correo || !tratamiento"
  >
    Siguiente
  </button>
</div>


  <!-- Sección 2 -->
  <div *ngIf="step === 2" class="form-step">
    <div class="form-group">
  <label for="fecha">Fecha</label>
  <input
    id="fecha"
    type="date"
    [(ngModel)]="fecha"
    name="fecha"
    required
    [min]="fechaMinima"
    (change)="validarFecha()"
    [class.invalid]="errorMessage"
  />
</div>

<!-- Campo hora -->
<div class="form-group" *ngIf="horasDisponibles.length > 0">
  <label for="hora">Selecciona el horario:</label>
  <select id="hora" [(ngModel)]="hora" name="hora" required class="hora-select">
    <option value="">Selecciona un horario</option>
    <option *ngFor="let horaDisponible of horasDisponibles" [value]="horaDisponible">
      {{ horaDisponible }}
    </option>
  </select>
</div>

<!-- Mensaje si no hay horarios -->
<div *ngIf="horasDisponibles.length === 0 && fecha && !errorMessage">
  <p class="error-message">No hay horas disponibles para esta fecha.</p>
</div>

<!-- Mensaje de error -->
<div *ngIf="errorMessage">
  <p class="error-message">{{ errorMessage }}</p>
</div>

    <button (click)="goToStep(1)" class="submit-btn">Anterior</button>
    <button (click)="goToStep(3)" class="submit-btn" [disabled]="!esHorarioValido()">Siguiente</button>
  </div>

  <!-- Sección 3 -->
  <div *ngIf="step === 3" class="form-step">
    <p class="price" *ngIf="precio.nacional">
      Valor del tratamiento nacional: <span class="amount">${{ precio.nacional | number:'1.0-0' }}</span>
    </p>
    
    <p class="price" *ngIf="precio.internacional">
      Valor del tratamiento internacional: <span class="amount">${{ precio.internacional | number:'1.0-0' }} USD</span>
    </p>
    
    <p class="price" *ngIf="precio.sesiones">
      Número de sesiones: <span class="amount">{{ precio.sesiones }}</span>
    </p>
    

    <button (click)="goToStep(2)" class="submit-btn">Anterior</button>
    <!-- Pago Webpay -->
<!-- Webpay -->
<button type="button" (click)="onSubmit('webpay')" class="submit-btn pago-btn">
 
  Pagar con Webpay
</button>

<!-- Mercado Pago -->
<button type="button" (click)="onSubmit('mercadopago')" class="submit-btn pago-btn">

  Pagar con MercadoPago
</button>

<!-- Klap -->
<button type="button" (click)="irAPagoKlap()" class="submit-btn pago-btn">

  Pagar con Klap
</button>



  </div>
</div>
